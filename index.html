<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Music League – Voter Stats</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      :root {
        color-scheme: dark light;
        --bg: #050816;
        --bg-alt: #0b1020;
        --fg: #f9fafb;
        --muted: #9ca3af;
        --accent: #fbbf24;
        --accent-soft: rgba(251, 191, 36, 0.2);
        --border: #1f2937;
        --card-radius: 16px;
        --shadow-soft: 0 18px 45px rgba(15,23,42,0.75);
        --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
                     "Segoe UI", sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: var(--font-sans);
        background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
        color: var(--fg);
        -webkit-font-smoothing: antialiased;
      }

      .page {
        max-width: 2000px;
        margin: 0 auto;
        padding: 32px 20px 40px;
      }

      header {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 28px;
      }

      h1 {
        font-size: 2rem;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        margin: 0;
        display: inline-flex;
        align-items: baseline;
        gap: 10px;
      }

      header p {
        margin: 0;
        color: var(--muted);
        max-width: 100%;
        line-height: 1.5;
      }

      .card {
        background:
          linear-gradient(145deg, rgba(15,23,42,0.96), rgba(15,23,42,0.88))
          padding-box;
        border-radius: var(--card-radius);
        border: 1px solid rgba(148,163,184,0.16);
        box-shadow: var(--shadow-soft);
        padding: 18px 18px 16px;
        position: relative;
        overflow: hidden;
      }

      .card::before {
        content: "";
        position: absolute;
        inset: -120px;
        background:
          radial-gradient(circle at 0 0, rgba(251,191,36,0.12), transparent 60%),
          radial-gradient(circle at 100% 0, rgba(56,189,248,0.16), transparent 60%);
        opacity: 0.75;
        pointer-events: none;
      }

      .card-inner {
        position: relative;
        z-index: 1;
      }

      .card h2 {
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: rgba(156,163,175,0.9);
        margin: 0 0 8px;
      }

      .card h2 strong {
        color: #e5e7eb;
      }

      .chart-container {
        position: relative;
        height: 420px;
        max-height: 70vh;
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding: 4px 2px 8px;
      }

      @media (max-width: 600px) {
        .chart-container {
          height: 380px;
        }
      }

      .bar-row {
        display: grid;
        grid-template-columns: minmax(0, 220px) minmax(0, 1fr) auto;
        align-items: center;
        gap: 8px;
        font-size: 0.76rem;
      }

      .bar-label {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        color: rgba(209,213,219,0.96);
      }

      .bar-track {
        position: relative;
        height: 6px;
        border-radius: 999px;
        background: rgba(15,23,42,0.96);
        overflow: hidden;
      }

      .bar-fill {
        position: absolute;
        inset: 0;
        border-radius: inherit;
        background: linear-gradient(90deg, rgba(251,191,36,0.2), rgba(251,191,36,0.95), rgba(56,189,248,0.95));
        box-shadow: 0 0 0 1px rgba(15,23,42,0.9);
      }

      .bar-value {
        font-variant-numeric: tabular-nums;
        color: rgba(156,163,175,0.96);
      }

      .matrix-card {
        margin-top: 22px;
      }

      .table-wrapper {
        margin-top: 8px;
        border-radius: 12px;
        border: 1px solid rgba(31,41,55,0.9);
        background:
          linear-gradient(180deg, rgba(15,23,42,0.96), rgba(15,23,42,0.96));
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .matrix-scroll {
        display: block;
        width: 100%;
        min-width: max-content;
      }

      table.matrix {
        width: 100%;
        min-width: max-content;
        border-collapse: collapse;
        font-size: 0.75rem;
      }

      table.matrix thead {
        position: sticky;
        top: 0;
        z-index: 1;
        background: linear-gradient(180deg, rgba(15,23,42,0.96), rgba(15,23,42,0.96));
      }

      table.matrix th,
      table.matrix td {
        padding: 5px 7px;
        text-align: center;
        white-space: nowrap;
      }

      table.matrix th:first-child,
      table.matrix td:first-child {
        text-align: left;
        position: sticky;
        left: 0;
        z-index: 2;
        background: rgba(15,23,42,0.96);
        max-width: 170px;
        width: 170px;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
      }

      table.matrix th {
        font-size: 0.76rem;
        color: rgba(209,213,219,0.96);
        border-bottom: 1px solid rgba(31,41,55,0.9);
      }

      table.matrix tbody td {
        font-variant-numeric: tabular-nums;
        color: rgba(148,163,184,0.96);
        border-bottom: 1px solid rgba(17,24,39,0.6);
      }

      table.matrix tbody tr:nth-child(odd) td {
        background: rgba(15,23,42,0.96);
      }

      table.matrix tbody tr:nth-child(even) td {
        background: rgba(15,23,42,0.9);
      }

      table.matrix td.matrix-cell {
        color: #fefce8;
      }

      table.matrix td.nonzero {
        font-weight: 500;
      }

      table.matrix td.diagonal-cell {
        background: #000 !important;
        color: rgba(148,163,184,0.96);
      }

      .rank-pill {
        display: inline-flex;
        min-width: 1.7em;
        align-items: center;
        justify-content: center;
        padding: 1px 6px;
        border-radius: 999px;
        font-variant-numeric: tabular-nums;
        font-size: 0.72rem;
        background: rgba(15,23,42,0.9);
        border: 1px solid rgba(55,65,81,0.95);
        color: rgba(209,213,219,0.95);
      }

      .rank-1 .rank-pill {
        border-color: rgba(251,191,36,0.9);
        color: #fef3c7;
        background: radial-gradient(circle at top, rgba(251,191,36,0.3), rgba(15,23,42,0.95));
      }

      .rank-2 .rank-pill {
        border-color: rgba(156,163,175,0.95);
      }

      .rank-3 .rank-pill {
        border-color: rgba(248,113,113,0.9);
      }

      .pill-name {
        font-size: 0.82rem;
        font-weight: 500;
      }

      .muted {
        color: rgba(156,163,175,0.9);
      }
      .matrix-caption {
        margin-top: 12px;
        font-size: 0.9rem;
        color: rgba(156,163,175,0.9);
        line-height: 1.5;
      }

      .page-footer {
        margin-top: 28px;
        font-size: 0.85rem;
        text-align: center;
      }
      .page-footer .credit {
        display: block;
        margin-top: 4px;
        color: rgba(148,163,184,0.8);
      }
      .page-footer a {
        color: rgba(148,163,184,0.9);
        text-decoration: none;
      }
      .page-footer a:hover {
        color: rgba(209,213,219,0.96);
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <main class="page">
      <header>
        <h1>Vote Stats</h1>
      </header>

      <section class="card">
        <div class="card-inner">
          <h2>Vote Generosity</h2>
          <div class="chart-container" id="generosity-chart"></div>
          <p class="matrix-caption">
            Generosity is the average points each voter gives out per track they rate with positive votes. High averages mean someone tends to hand out bigger scores rather than spreading them out.
          </p>
        </div>
      </section>

      <section class="card matrix-card">
        <div class="card-inner">
          <h2>Vote Distribution</h2>
          <div class="table-wrapper" id="vote-matrix"></div>
          <p class="matrix-caption">
            Rows = voter (the person giving points).
            Column headers = receiver (the person who submitted the track).
            Cell at (row, column) = total points the row person gave to the column person's tracks (sum of all positive points across rounds).
          </p>
        </div>
      </section>

      <footer class="page-footer">
        <a href="https://github.com/davidmn/music-league-stats" target="_blank" rel="noopener noreferrer">GitHub</a>
        <span class="credit">Made by MegaSlippers</span>
      </footer>
    </main>

    <script>
      const chartLabels = ["Banana Log", "MegaSlippers", "Joe Bond", "Beehind Honemy Lines", "Honey WillBeFree", "Baba,  Don't Rile Bee", "A Stylish Little Bee In A Shacket And Jorts (A Sartorial Bee)", "mooshty", "misterbrilliant", "We've got honey at home. \ud83c\udf6f\ud83c\udfe0", "All the Better to Sting You With", "Liv, Laugh, Cover Urself in Pollen", "Patrick Rose", "Joe Skrebels", "How \u231a since you \ud83d\udc40 a \ud83d\udc1d? I Missenden (Cain)", "\ud83d\ude82 Alice Einsteigen, To Bee Town!", "Gav Murphy"];
      const chartValues = [1.72, 1.67, 1.6, 1.56, 1.56, 1.52, 1.35, 1.29, 1.19, 1.16, 1.11, 1.05, 1.04, 0.75, 0.7, 0.69, 0.67];
      const voters = [{"rank": 1, "name": "Banana Log", "total_points": 50, "num_votes": 29, "num_positive_votes": 29, "avg_points_per_vote": 1.72, "avg_points_when_positive": 1.72}, {"rank": 2, "name": "MegaSlippers", "total_points": 50, "num_votes": 30, "num_positive_votes": 27, "avg_points_per_vote": 1.67, "avg_points_when_positive": 1.85}, {"rank": 3, "name": "Joe Bond", "total_points": 40, "num_votes": 25, "num_positive_votes": 25, "avg_points_per_vote": 1.6, "avg_points_when_positive": 1.6}, {"rank": 4, "name": "Beehind Honemy Lines", "total_points": 50, "num_votes": 32, "num_positive_votes": 31, "avg_points_per_vote": 1.56, "avg_points_when_positive": 1.61}, {"rank": 5, "name": "Honey WillBeFree", "total_points": 50, "num_votes": 32, "num_positive_votes": 31, "avg_points_per_vote": 1.56, "avg_points_when_positive": 1.61}, {"rank": 6, "name": "Baba,  Don't Rile Bee", "total_points": 50, "num_votes": 33, "num_positive_votes": 32, "avg_points_per_vote": 1.52, "avg_points_when_positive": 1.56}, {"rank": 7, "name": "A Stylish Little Bee In A Shacket And Jorts (A Sartorial Bee)", "total_points": 50, "num_votes": 37, "num_positive_votes": 27, "avg_points_per_vote": 1.35, "avg_points_when_positive": 1.85}, {"rank": 8, "name": "mooshty", "total_points": 40, "num_votes": 31, "num_positive_votes": 20, "avg_points_per_vote": 1.29, "avg_points_when_positive": 2.0}, {"rank": 9, "name": "misterbrilliant", "total_points": 50, "num_votes": 42, "num_positive_votes": 25, "avg_points_per_vote": 1.19, "avg_points_when_positive": 2.0}, {"rank": 10, "name": "We've got honey at home. \ud83c\udf6f\ud83c\udfe0", "total_points": 50, "num_votes": 43, "num_positive_votes": 33, "avg_points_per_vote": 1.16, "avg_points_when_positive": 1.52}, {"rank": 11, "name": "All the Better to Sting You With", "total_points": 30, "num_votes": 27, "num_positive_votes": 22, "avg_points_per_vote": 1.11, "avg_points_when_positive": 1.36}, {"rank": 12, "name": "Liv, Laugh, Cover Urself in Pollen", "total_points": 20, "num_votes": 19, "num_positive_votes": 14, "avg_points_per_vote": 1.05, "avg_points_when_positive": 1.43}, {"rank": 13, "name": "Patrick Rose", "total_points": 50, "num_votes": 48, "num_positive_votes": 32, "avg_points_per_vote": 1.04, "avg_points_when_positive": 1.56}, {"rank": 14, "name": "Joe Skrebels", "total_points": 50, "num_votes": 67, "num_positive_votes": 32, "avg_points_per_vote": 0.75, "avg_points_when_positive": 1.56}, {"rank": 15, "name": "How \u231a since you \ud83d\udc40 a \ud83d\udc1d? I Missenden (Cain)", "total_points": 40, "num_votes": 57, "num_positive_votes": 27, "avg_points_per_vote": 0.7, "avg_points_when_positive": 1.48}, {"rank": 16, "name": "\ud83d\ude82 Alice Einsteigen, To Bee Town!", "total_points": 40, "num_votes": 58, "num_positive_votes": 33, "avg_points_per_vote": 0.69, "avg_points_when_positive": 1.21}, {"rank": 17, "name": "Gav Murphy", "total_points": 50, "num_votes": 75, "num_positive_votes": 33, "avg_points_per_vote": 0.67, "avg_points_when_positive": 1.52}];
      const matrixNames = ["A Stylish Little Bee In A Shacket And Jorts (A Sartorial Bee)", "\ud83d\ude82 Alice Einsteigen, To Bee Town!", "All the Better to Sting You With", "Baba,  Don't Rile Bee", "Banana Log", "Beehind Honemy Lines", "Gav Murphy", "Honey WillBeFree", "How \u231a since you \ud83d\udc40 a \ud83d\udc1d? I Missenden (Cain)", "itbrose", "Joe Bond", "Joe Skrebels", "Liv, Laugh, Cover Urself in Pollen", "MegaSlippers", "misterbrilliant", "mooshty", "Patrick Rose", "We've got honey at home. \ud83c\udf6f\ud83c\udfe0"];
      const matrix = [[0, 0, 0, 3, 1, 0, 5, 5, 7, 0, 5, 1, 1, 4, 3, 4, 7, 4], [1, 0, 0, 2, 2, 1, 6, 2, 1, 0, 1, 3, 1, 3, 7, 3, 4, 3], [2, 2, 0, 4, 1, 0, 3, 1, 2, 0, 0, 0, 3, 2, 4, 2, 3, 1], [1, 3, 1, 0, 6, 1, 10, 2, 2, 0, 1, 3, 3, 6, 6, 3, 2, 0], [1, 0, 4, 5, 0, 4, 2, 6, 1, 0, 3, 5, 0, 2, 8, 5, 1, 3], [4, 2, 2, 2, 2, 0, 1, 4, 1, 0, 2, 4, 3, 5, 5, 3, 6, 4], [3, 2, 0, 4, 0, 0, 0, 4, 1, 0, 0, 3, 5, 6, 10, 2, 3, 7], [4, 2, 1, 4, 6, 4, 0, 0, 5, 0, 0, 0, 0, 3, 4, 4, 12, 1], [3, 1, 2, 4, 5, 2, 1, 6, 0, 0, 1, 2, 0, 4, 3, 1, 3, 2], [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0], [2, 1, 6, 1, 1, 2, 3, 3, 1, 0, 0, 8, 0, 1, 3, 3, 3, 2], [2, 1, 2, 8, 2, 1, 6, 2, 0, 0, 2, 0, 3, 2, 9, 5, 3, 2], [3, 0, 0, 1, 1, 0, 2, 0, 1, 0, 3, 0, 0, 2, 4, 1, 1, 1], [5, 1, 0, 2, 7, 2, 3, 2, 5, 0, 5, 0, 0, 0, 4, 1, 7, 6], [9, 1, 5, 3, 5, 4, 8, 1, 2, 0, 0, 4, 0, 2, 0, 3, 0, 3], [1, 6, 0, 2, 12, 3, 2, 0, 5, 0, 1, 0, 2, 4, 1, 0, 1, 0], [3, 2, 3, 4, 5, 3, 3, 0, 0, 0, 4, 4, 0, 7, 5, 5, 0, 2], [5, 0, 0, 2, 4, 6, 8, 4, 2, 0, 2, 3, 0, 3, 7, 4, 0, 0]];

      function renderChart() {
        const container = document.getElementById("generosity-chart");
        if (!container) return;

        container.innerHTML = "";

        if (!chartLabels.length) {
          const empty = document.createElement("div");
          empty.className = "muted";
          empty.textContent = "No voters found.";
          container.appendChild(empty);
          return;
        }

        const maxValue = Math.max.apply(null, chartValues);

        chartLabels.forEach((label, idx) => {
          const value = chartValues[idx];
          const row = document.createElement("div");
          row.className = "bar-row";

          const nameEl = document.createElement("div");
          nameEl.className = "bar-label";
          nameEl.textContent = label;

          const track = document.createElement("div");
          track.className = "bar-track";

          const fill = document.createElement("div");
          fill.className = "bar-fill";
          const widthPct = maxValue > 0 ? (value / maxValue) * 100 : 0;
          fill.style.width = widthPct.toFixed(1) + "%";

          track.appendChild(fill);

          const valueEl = document.createElement("div");
          valueEl.className = "bar-value";
          valueEl.textContent = value.toFixed(2);

          row.appendChild(nameEl);
          row.appendChild(track);
          row.appendChild(valueEl);

          container.appendChild(row);
        });
      }

      function truncName(name, max) {
        if (!name) return "";
        if (name.length <= max) return name;
        return name.slice(0, max - 1) + "…";
      }

      function renderMatrix() {
        const container = document.getElementById("vote-matrix");
        if (!container) return;

        container.innerHTML = "";

        if (!matrixNames.length) {
          const empty = document.createElement("div");
          empty.className = "muted";
          empty.textContent = "No vote data available.";
          container.appendChild(empty);
          return;
        }

        const scrollDiv = document.createElement("div");
        scrollDiv.className = "matrix-scroll";

        const table = document.createElement("table");
        table.className = "matrix";

        // Find global min/max to normalise the colour scale (yellow at min, blue at max).
        let minCell = 0;
        let maxCell = 0;
        let seen = false;
        matrix.forEach((row) => {
          (row || []).forEach((val) => {
            if (!seen) { minCell = val; maxCell = val; seen = true; }
            else { if (val < minCell) minCell = val; if (val > maxCell) maxCell = val; }
          });
        });
        const range = maxCell - minCell;

        const thead = document.createElement("thead");
        const headRow = document.createElement("tr");

        const corner = document.createElement("th");
        corner.textContent = "";
        headRow.appendChild(corner);

        matrixNames.forEach((name) => {
          const th = document.createElement("th");
          th.textContent = truncName(name, 8);
          th.title = name;
          headRow.appendChild(th);
        });

        thead.appendChild(headRow);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");

        matrixNames.forEach((giverName, rowIdx) => {
          const tr = document.createElement("tr");

          const rowHeader = document.createElement("th");
          rowHeader.textContent = truncName(giverName, 22);
          rowHeader.title = giverName;
          tr.appendChild(rowHeader);

          const rowData = matrix[rowIdx] || [];
          matrixNames.forEach((_, colIdx) => {
            const td = document.createElement("td");
            const value = rowData[colIdx] ?? 0;
            td.textContent = rowIdx === colIdx ? "–" : String(value);

            if (rowIdx === colIdx) {
              td.classList.add("matrix-cell", "diagonal-cell");
            } else if (range > 0) {
              const t = (value - minCell) / range; // 0 = min (yellow), 1 = max (blue)
              const r = Math.round(251 + (56 - 251) * t);
              const g = Math.round(191 + (189 - 191) * t);
              const b = Math.round(36 + (248 - 36) * t);
              const alpha = 0.45 + 0.5 * t;
              td.classList.add("matrix-cell");
              td.style.backgroundColor = `rgba(${r}, ${g}, ${b}, ${alpha.toFixed(2)})`;
              if (value > 0) td.classList.add("nonzero");
            } else if (value > 0) {
              td.classList.add("nonzero");
            }

            tr.appendChild(td);
          });

          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        scrollDiv.appendChild(table);
        container.appendChild(scrollDiv);
      }

      renderChart();
      renderMatrix();
    </script>
  </body>
</html>
